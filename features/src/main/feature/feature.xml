<?xml version="1.0" encoding="UTF-8"?>

<features xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" name="timeboard-${project.version}"
          xmlns="http://karaf.apache.org/xmlns/features/v1.4.0"
          xsi:schemaLocation="http://karaf.apache.org/xmlns/features/v1.4.0">

    <repository>mvn:org.ops4j.pax.web/pax-web-features/7.3.4/xml/features</repository>

    <feature name="timeboard-base" version="${project.version}">
        <feature>scr</feature>
        <feature>http</feature>
        <feature>http-whiteboard</feature>
        <feature>transaction</feature>
        <feature>jndi</feature>
        <feature>pax-jdbc-config</feature>
        <feature>pax-jdbc-pool-dbcp2</feature>
        <feature>jdbc</feature>
        <feature>jaas</feature>
        <feature dependency="true">aries-blueprint</feature>
        <feature version="[2,3)">jpa</feature>
        <feature version="[5,6)">hibernate</feature>
        <bundle start-level="70">mvn:mysql/mysql-connector-java/8.0.17</bundle>
        <bundle start-level="70">mvn:org.ops4j.pax.jdbc/pax-jdbc-mysql/1.4.0</bundle>
    </feature>

    <feature name="timeboard-datasource" version="${project.version}">
        <config name="org.ops4j.datasource-timeboard-core-ds">
            dataSourceName=timeboard-core-ds
            osgi.jdbc.driver.class=com.mysql.cj.jdbc.Driver
            url=jdbc:mysql://localhost:3306/timeboard?createDatabaseIfNotExist=true
            user=root
            password=timeboard
            dialect=org.hibernate.dialect.MySQL8Dialect
        </config>
        <config name="org.ops4j.pax.web">
            org.osgi.service.http.port=8181
            javax.servlet.context.tempdir=${karaf.data}/pax-web-jsp
            org.ops4j.pax.web.config.file=${karaf.etc}/jetty.xml
            org.apache.karaf.features.configKey=org.ops4j.pax.web
            org.ops4j.pax.web.session.timeout=30
        </config>
        <capability>
            osgi.service;objectClass=javax.sql.DataSource;effective:=active;osgi.jndi.service.name=timeboard-core-ds
        </capability>
    </feature>

    <feature name="timeboard-core" version="${project.version}">
        <feature>timeboard-base</feature>
        <feature>timeboard-datasource</feature>
        <bundle start-level="80">mvn:${project.groupId}/core/${project.version}</bundle>
    </feature>


    <feature name="timeboard-core-ui" version="${project.version}">
        <feature>war</feature>
        <feature>timeboard-base</feature>
        <bundle start-level="80">mvn:${project.groupId}/core-ui/${project.version}</bundle>
        <bundle start-level="80">mvn:${project.groupId}/theme/${project.version}</bundle>
    </feature>


    <feature name="timeboard-security" version="${project.version}">
        <feature>timeboard-core</feature>
        <feature>timeboard-core-ui</feature>
        <bundle start-level="80">mvn:${project.groupId}/security/${project.version}</bundle>
    </feature>

    <feature name="timeboard-home" version="${project.version}">
        <feature>timeboard-core</feature>
        <feature>timeboard-core-ui</feature>
        <feature>timeboard-security</feature>
        <bundle start-level="80">mvn:${project.groupId}/home/${project.version}</bundle>
    </feature>

    <feature name="timeboard-account" version="${project.version}">
        <feature>timeboard-core</feature>
        <feature>timeboard-core-ui</feature>
        <feature>timeboard-security</feature>
        <bundle start-level="80">mvn:${project.groupId}/account/${project.version}</bundle>
    </feature>

    <feature name="timeboard-projects" version="${project.version}">
        <feature>timeboard-core</feature>
        <feature>timeboard-core-ui</feature>
        <feature>timeboard-security</feature>
        <bundle start-level="80">mvn:${project.groupId}/projects/${project.version}</bundle>
    </feature>

    <feature name="timeboard-timesheet" version="${project.version}">
        <feature>timeboard-core</feature>
        <feature>timeboard-core-ui</feature>
        <feature>timeboard-security</feature>
        <bundle start-level="80">mvn:${project.groupId}/timesheet/${project.version}</bundle>
    </feature>

    <feature name="timeboard-plugins" version="${project.version}">
        <feature>timeboard-core</feature>
        <bundle start-level="80">mvn:${project.groupId}/project-github-import-plugin/${project.version}</bundle>
        <bundle start-level="80">mvn:${project.groupId}/project-jira-import-plugin/${project.version}</bundle>
        <bundle start-level="80">mvn:${project.groupId}/project-msp-export-plugin/${project.version}</bundle>
        <bundle start-level="80">mvn:${project.groupId}/project-xls-export-plugin/${project.version}</bundle>
    </feature>


    <feature name="timeboard-shell" version="${project.version}">
        <feature>timeboard-core</feature>
        <bundle start-level="80">mvn:${project.groupId}/shell/${project.version}</bundle>
    </feature>
</features>