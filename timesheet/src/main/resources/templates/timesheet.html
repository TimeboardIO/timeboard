<!DOCTYPE html>

<html layout:decorate="~{layouts/general.html(path='/timesheet')}"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org" xmlns:v-bind="http://www.w3.org/1999/xhtml"
      xmlns:v-on="http://www.w3.org/1999/xhtml">

<head>
    <meta property="timesheet" th:year="${year}" th:week="${week}"/>
</head>

<body>

<div layout:fragment="content">

    <div id="timesheet">

        <div class="timesheet-navigation-controls">

            <input class="ui positive basic button"
                   v-if="validated === false"
                   v-bind:data-week="week"
                   v-bind:data-year="year"
                   v-on:click="validateMyWeek"
                   style="left: 1em; position: absolute;"
                   type="submit" value="Validate My Week">


            <a class="ui labeled icon button" v-bind:href="'/timesheet?week='+(week-1)+'&year='+year">
                <i class="left arrow icon"></i>Previous week</a>

            <span class="ui blue circular label bug">Week {{ week }}</span>


            <a class="ui right labeled icon button" v-bind:href="'/timesheet?week='+(week+1)+'&year='+year">
                <i class="right arrow icon"></i>Next week</a>
        </div>

         <div class="ui inverted dimmer">
            <div class="ui text loader">Loading</div>
        </div>

        <fieldset v-bind:disabled="validated === true" style="padding: 0px; margin: 0px; border: none;">
            <form class="ui form" read enctype="application/x-www-form-urlencoded" method="post">

                <table class="ui celled table" style="text-align:center">
                    <thead>
                    <tr>
                        <th class="two wide">Task</th>
                        <th class="wide one" style="text-align:center" v-for="day in days">
                            <div>{{day.day}}</div>
                            <div class="grey header">{{new Date(day.date).toLocaleDateString()}}</div>
                            <div class="ui circular label large" style="margin-top: 5px;"
                                 v-bind:day-badge="day.date">
                                {{ getImputationSum(day.date).toFixed(1) }}
                            </div>
                        </th>
                        <th class="wide one">Effort spent</th>
                        <th class="wide one">Remain To Be Done</th>
                        <th class="wide one">Original estimate</th>
                        <th class="wide one">Restimate</th>
                    </tr>
                    </thead>
                    <tbody>
                    <template v-for="(project, projectID) in projects">
                        <tr>
                            <th class="two wide">Total</th>
                            <th class="wide one" style="text-align:center" v-for="day in days">

                                <div v-bind:id="day.date" class="ui circular label red large day-badge" style="margin-top: 5px;"
                                     v-bind:day-badge="day.date">
                                    {{ getImputationSum(day.date).toFixed(1) }}
                                </div>
                            </th>
                            <th class="wide one" data-content="Effort spent" rowspan="2" >ES</th>
                            <th class="wide one" data-content="Remain To Be Done" rowspan="2" >EL</th>
                            <th class="wide one" data-content="Restimate" rowspan="2" >RE</th>
                            <th class="wide one" data-content="Original estimate" rowspan="2" >OE</th>

                        </tr>
                        <tr v-for="(task, taskID) in project.tasks">
                            <td>{{ task.taskName }}</td>
                           <td v-for="day in days">
                                <input
                                        max="1"
                                        min="0"
                                        step="0.1"
                                        v-if="(day.date >= task.startDate) && (day.date <= task.endDate)"
                                        v-on:focusout="triggerUpdateTask"
                                        v-bind:data-date="day.date"
                                        v-bind:data-task="taskID"
                                        v-bind:name="'task['+taskID+']day['+day.date+']'"
                                        v-bind:value="getImputation(day.date, taskID).toFixed(1)"
                                        type="number"/>
                            </td>
                            <td v-bind:data-task-es="taskID">{{task.effortSpent.toFixed(1)}}</td>
                            <td><input
                                    min="0"
                                    step="0.1"
                                    name="remainsToBeDone"
                                    v-on:focusout="triggerUpdateRTBD"
                                    v-bind:value="task.remainToBeDone.toFixed(1)"
                                    v-bind:data-task-rtbd="taskID"
                                    type="number"
                            /></td>
                            <td v-bind:data-task-ew="taskID">{{task.estimateWork.toFixed(1)}}</td>
                            <td
                                    v-bind:data-task-rew="taskID">{{task.reEstimateWork.toFixed(1)}}
                            </td>
                        </tr>
                    </template>
                    </tbody>
                </table>


            </form>
        </fieldset>
        <script src="/timesheet/static/timesheet.js"></script>

    </div>
</div>

</body>
</html>