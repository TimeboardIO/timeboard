<!DOCTYPE html>

<html layout:decorate="~{core-ui:layouts/general.html(path='/timesheet')}"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org" xmlns:v-bind="http://www.w3.org/1999/xhtml"
      xmlns:v-on="http://www.w3.org/1999/xhtml">

<head>
    <meta property="timesheet" th:year="${year}" th:week="${week}" th:lastWeekValidated="${lastWeekValidated}"/>
</head>

<body>

<div layout:fragment="content">

    <div id="timesheet">
        <div class="ui segment timesheet-navigation-controls">
            <div style="left: 1em; position: absolute;"
                 v-bind:data-tooltip="!enableValidateButton()?'Please validate last week and check you have all imputation day total = 1' : false"
                 data-position="right center">
                <input v-if="validated === false"
                       v-bind:data-week="week"
                       v-bind:data-year="year"
                       v-on:click="validateMyWeek"
                       v-bind:class="{'ui positive button':true, 'disabled':(!enableValidateButton())}"
                       type="submit" value="Validate My Week">
                <div v-if="validated === true" class="ui positive horizontal label">Week validated</div>
            </div>

            <a class="ui labeled icon button" v-bind:href="'/timesheet?week='+lastWeek(year,week)+'&year='+lastWeekYear(year,week)">
                <i class="left arrow icon"></i>Previous week</a>

            <span class="ui blue circular label bug">Week {{ week }}</span>

            <a class="ui right labeled icon button" v-bind:href="'/timesheet?week='+nextWeek(year,week)+'&year='+nextWeekYear(year,week)">
                <i class="right arrow icon"></i>Next week</a>
        </div>

        <div class="ui inverted dimmer">
            <div class="ui text loader">Loading</div>
        </div>
        <div class="ui segment">
            <fieldset v-bind:disabled="validated === true" style="padding: 0px; margin: 0px; border: none;">
                <form class="ui form" read enctype="application/x-www-form-urlencoded" method="post">

                    <table class="ui celled table" style="text-align:center">
                        <thead>
                        <tr class="">
                            <th class="two wide project"></th>
                            <th class="wide one project" style="text-align:center" v-for="day in days">
                                {{ day.day }} {{ new Date(day.date).getDate() }}
                            </th>
                            <th class="wide one project" colspan="4"></th>


                        </tr>
                        <tr>
                            <th class="two wide">Task</th>
                            <th class="wide one" style="text-align:center" v-for="day in days">

                                <div v-if="(day.day != 'Saturday') && (day.day != 'Sunday')"
                                     v-bind:id="day.date"
                                     v-bind:class="{'ui circular label large day-badge':true,
                                      'green':(getImputationSum(day.date).toFixed(1) >= 1),
                                      'red':(getImputationSum(day.date).toFixed(1) < 1)}"
                                     style="margin-top: 5px;"
                                     v-bind:day-badge="day.date">
                                    {{ getImputationSum(day.date).toFixed(1) }}
                                </div>

                                <div v-if="(day.day == 'Saturday') || (day.day == 'Sunday')"
                                     v-bind:id="day.date"
                                     v-bind:class="{'ui circular label large day-badge':true,
                                      'green':(getImputationSum(day.date).toFixed(1) >= 1)}"
                                     style="margin-top: 5px;"
                                     v-bind:day-badge="day.date">
                                    {{ getImputationSum(day.date).toFixed(1) }}
                                </div>
                            </th>
                            <th class="wide one" data-tooltip="Effort spent" rowspan="1">ES</th>
                            <th class="wide one" data-tooltip="Remain To Be Done" rowspan="1">EL</th>
                            <th class="wide one" data-tooltip="Restimate" rowspan="1">RE</th>
                            <th class="wide one" data-tooltip="Original estimate" rowspan="1">OE</th>

                        </tr>

                        </thead>
                        <tbody>
                        <template v-for="(project, projectID) in projects">
                            <tr>
                                <td class="ui header left aligned project" colspan="12">{{ project.projectName }}</td>
                            </tr>
                            <tr v-for="(task, taskID) in project.tasks">
                                <td>{{ task.taskName }}</td>
                                <td v-for="day in days">
                                    <div class="ui input">
                                    <input
                                            max="1"
                                            min="0"
                                            step="0.1"
                                            v-if="(day.date >= task.startDate) && (day.date <= task.endDate)"
                                            v-on:focusout="triggerUpdateTask"
                                            v-on:click="triggerUpdateTask"
                                            v-bind:data-date="day.date"
                                            v-bind:data-task="taskID"
                                            v-bind:name="'task['+taskID+']day['+day.date+']'"
                                            v-bind:value="getImputation(day.date, taskID).toFixed(1)"
                                            type="number"/>
                                     <i class="search icon hidden" style="color: transparent;"></i>
                                    </div>
                                </td>
                                <td v-bind:data-task-es="taskID">{{task.effortSpent.toFixed(1)}}</td>
                                <td>
                                    <div class="ui input">
                                    <input
                                        min="0"
                                        step="0.1"
                                        name="remainsToBeDone"
                                        v-on:focusout="triggerUpdateRTBD"
                                        v-bind:value="task.remainToBeDone.toFixed(1)"
                                        v-bind:data-task-rtbd="taskID"
                                        type="number"
                                    />
                                     <i class="search icon hidden" style="color: transparent;"></i>

                                    </div>
                                </td>
                                <td v-bind:data-task-ew="taskID">{{task.estimateWork.toFixed(1)}}</td>
                                <td
                                        v-bind:data-task-rew="taskID">{{task.reEstimateWork.toFixed(1)}}
                                </td>
                            </tr>
                        </template>
                        </tbody>
                    </table>


                </form>
            </fieldset>
        </div>
        <script src="/timesheet/static/timesheet.js"></script>

    </div>
</div>

</body>
</html>